<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å Quiz</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: "Noto Sans Thai", sans-serif; background: #f5f5f5; padding:16px; margin:0; }
    .container { max-width:400px; margin:0 auto; background:#fff; padding:16px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h1 { text-align:center; color:#003366; margin-bottom:20px; }
    #progressContainer { background:#e9ecef; border-radius:8px; height:10px; overflow:hidden; margin-bottom:16px; }
    #progressBar { background:#28a745; width:0%; height:100%; transition: width 0.4s ease; }
    #questionContainer, #videoContainer, #result { display:none; }
    .active { display:block; }
    .question { opacity:0; animation:fadeInUp 0.5s forwards; margin-bottom:12px; }
    @keyframes fadeInUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .question p { font-weight:bold; margin:0 0 8px; }
    label { display:block; margin-bottom:6px; cursor:pointer; }
    #explanation { color:#dc3545; margin-bottom:12px; }
    .btn { display:block; width:100%; padding:12px; background:#007BFF; color:#fff; border:none; border-radius:8px; margin-top:12px; cursor:pointer; }
    .btn:hover { background:#0056b3; }
    iframe { width:100%; height:200px; border:none; border-radius:8px; margin-bottom:12px; }
    #result h2 { margin-bottom:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å Quiz</h1>
    <div id="progressContainer"><div id="progressBar"></div></div>

    <!-- Question -->
    <div id="questionContainer" class="active">
      <div class="question" id="questionText"></div>
      <div id="options"></div>
      <div id="explanation"></div>
      <button id="nextBtn" class="btn" style="display:none;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    </div>

    <!-- Video -->
    <div id="videoContainer">
      <iframe id="videoFrame" src=""></iframe>
      <button id="afterVideoBtn" class="btn">‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
    </div>

    <!-- Result -->
    <div id="result">
      <h2 id="resultTitle"></h2>
      <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span id="score"></span>/10</p>
      <button id="shareBtn" class="btn">‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
    </div>
  </div>

<script>
const liffId  = '2005789397-ROQvjpYk';
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzDE6SfY8Mabbwn-ojHWmNbqov0XYtpHZqFiOzM9SnISPnPNhOuy7x3wZj1lsV_CtvOFA/exec';
const VIDEO_LINK = 'https://drive.google.com/file/d/1nl2Bxxdw8DLz1aTuAgbjauJftkragv7W/preview';

let userId='', userName='';
let segment = 0, phase='pre', idx = 0, answered=0, correctCount=0;
const postAnswers = [];

// ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° pre/post ‡πÅ‡∏ï‡πà‡∏•‡∏∞ segment
const segments = [
  { pre: [
      {q:'1. Pre1: Stroke ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?', opts:['‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î','‡∏™‡∏°‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠','‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô','‡∏™‡∏°‡∏≠‡∏á‡∏ó‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î'], a:0},
      {q:'2. Pre2: ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠?', opts:['‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á','‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô','‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà','‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß'], a:2},
      {q:'3. Pre3: ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠?', opts:['‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á','‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á','‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà'], a:0}
    ],
    post: [
      {q:'1. Post1: Stroke ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?', opts:['‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î','‡∏™‡∏°‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠','‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô','‡∏™‡∏°‡∏≠‡∏á‡∏ó‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î'], a:0, exp:'Stroke ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏°‡∏≠‡∏á'},
      {q:'2. Post2: ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠?', opts:['‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á','‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô','‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà','‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß'], a:2, exp:'‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ'},
      {q:'3. Post3: ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠?', opts:['‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á','‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á','‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà'], a:0, exp:'‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ'}
    ]
  },
  { pre: [
      {q:'4. Pre1: B ‡πÉ‡∏ô BE-FAST ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å?', opts:['Balance','Blink','Breathing','Blood'], a:0},
      {q:'5. Pre2: E ‡πÉ‡∏ô BE-FAST ‡∏Ñ‡∏∑‡∏≠?', opts:['Eyes','Exercise','Eat','Energy'], a:0},
      {q:'6. Pre3: S ‡πÉ‡∏ô BE-FAST ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å?', opts:['Speech','Smile','Shock','Sense'], a:0}
    ],
    post: [
      {q:'4. Post1: B = ?', opts:['Balance','Blink','Breathing','Blood'], a:0, exp:'B = Balance'},
      {q:'5. Post2: E = ?', opts:['Eyes','Exercise','Eat','Energy'], a:0, exp:'E = Eyes'},
      {q:'6. Post3: S = ?', opts:['Speech','Smile','Shock','Sense'], a:0, exp:'S = Speech'}
    ]
  },
  { pre: [
      {q:'7. Pre1: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?', opts:['‡πÇ‡∏ó‡∏£1669','‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥','‡∏ô‡∏≠‡∏ô‡∏û‡∏±‡∏Å','‡πÑ‡∏õ‡∏´‡∏≤‡∏´‡∏°‡∏≠'], a:0},
      {q:'8. Pre2: rtPA ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô?', opts:['4.5 ‡∏ä‡∏°','6 ‡∏ä‡∏°','3 ‡∏ä‡∏°','2 ‡∏ä‡∏°'], a:0},
      {q:'9. Pre3: ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ä‡πâ?', opts:['‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á','‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà','‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°','‡πÇ‡∏ó‡∏£‡∏ö‡∏≠‡∏Å'], a:0}
    ],
    post: [
      {q:'7. Post1: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å?', opts:['‡πÇ‡∏ó‡∏£1669','‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥','‡∏ô‡∏≠‡∏ô‡∏û‡∏±‡∏Å','‡πÑ‡∏õ‡∏´‡∏≤‡∏´‡∏°‡∏≠'], a:0, exp:'‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏ó‡∏£1669'},
      {q:'8. Post2: rtPA ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô?', opts:['4.5 ‡∏ä‡∏°','6 ‡∏ä‡∏°','3 ‡∏ä‡∏°','2 ‡∏ä‡∏°'], a:0, exp:'4.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á'},
      {q:'9. Post3: ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ä‡πâ?', opts:['‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á','‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà','‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°','‡πÇ‡∏ó‡∏£‡∏ö‡∏≠‡∏Å'], a:0, exp:'‡πÉ‡∏ä‡πâ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'}
    ]
  },
  { pre: [
      {q:'10. Pre1: ‡∏õ‡∏∏‡πà‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÉ‡∏ô LINE ‡∏Ñ‡∏∑‡∏≠?', opts:['‡πÇ‡∏ó‡∏£1669','‡πÇ‡∏ó‡∏£191','‡∏™‡πà‡∏á‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå','‡πÇ‡∏ó‡∏£1442'], a:0}
    ],
    post: [
      {q:'10. Post1: ‡∏õ‡∏∏‡πà‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏≠?', opts:['‡πÇ‡∏ó‡∏£1669','‡πÇ‡∏ó‡∏£191','‡∏™‡πà‡∏á‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå','‡πÇ‡∏ó‡∏£1442'], a:0, exp:'‡πÇ‡∏ó‡∏£1669'}
    ]
  }
];

const totalQuestions = segments.reduce((sum,s)=> sum + s.pre.length + s.post.length,0);

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF
async function init() {
  await liff.init({ liffId });
  if (!liff.isLoggedIn()) await liff.login();
  const prof = await liff.getProfile();
  userId = prof.userId; userName = prof.displayName;
  showCurrent();
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Progress Bar
function updateProgress() {
  $('#progressBar').css('width', `${(answered/totalQuestions)*100}%`);
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
function showCurrent() {
  $('#explanation').hide().text('');
  $('#nextBtn').hide();
  updateProgress();
  if (phase === 'pre' || phase === 'post') {
    $('#videoContainer, #result').hide();
    $('#questionContainer').show().addClass('active');
    const list = segments[segment][phase];
    const item = list[idx];
    $('#questionText').text(item.q);
    $('#options').empty();
    item.opts.forEach((opt,i) => {
      $('#options').append(`<label><input type="radio" name="opt" value="${i}"> ${opt}</label>`);
    });
    $('#questionContainer').css('opacity',0).animate({opacity:1},400);
  } else if (phase === 'video') {
    $('#questionContainer, #result').hide();
    $('#videoContainer').show();
    $('#videoFrame').attr('src', VIDEO_LINK);
  }
}

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
$(document).on('change','input[name=opt]',function(){
  const val = parseInt($(this).val());
  const item = segments[segment][phase][idx];
  answered++; updateProgress();
  if (phase === 'pre') {
    if (val !== item.a) {
      $('#explanation').show().text('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞');
    } else {
      $('#explanation').hide();
    }
  } else { // post
    if (val === item.a) {
      $('#explanation').show().text('‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!');
      correctCount++;
      postAnswers.push(1);
    } else {
      $('#explanation').show().text(`‚ùå ‡∏ú‡∏¥‡∏î: ${item.exp}`);
      postAnswers.push(0);
    }
  }
  $('#nextBtn').show();
});

// ‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
$('#nextBtn').click(()=> {
  $('#explanation').hide();
  if (phase === 'pre') {
    if (idx + 1 < segments[segment].pre.length) {
      idx++;
    } else {
      phase = 'video'; idx = 0;
    }
  } else if (phase === 'video') {
    phase = 'post'; idx = 0;
  } else { // post
    if (idx + 1 < segments[segment].post.length) {
      idx++;
    } else {
      // ‡∏à‡∏ö segment
      if (segment + 1 < segments.length) {
        segment++; phase = 'pre'; idx = 0;
      } else {
        // ‡∏à‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        showResult(); return;
      }
    }
  }
  $('input[name=opt]').prop('checked',false);
  showCurrent();
});

// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ
function showResult() {
  $('#questionContainer, #videoContainer').hide();
  $('#resultTitle').text(`${userName} ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡πÑ‡∏î‡πâ ${correctCount}/10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô` +
    (correctCount >= 8 ? ' üëë' : ''));
  $('#score').text(correctCount);
  $('#result').show();
  // ‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  $.post(GAS_URL, JSON.stringify({ userId, postAnswers, score: correctCount }));
}

// ‡πÅ‡∏ä‡∏£‡πå Flex
$('#shareBtn').click(()=>{
  const bubble = {
    type:'flex', altText:'‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö', contents:{
      type:'bubble',
      body:{ type:'box', layout:'vertical', backgroundColor:'#FFF1C1', contents:[
        { type:'text', text:`${userName}`, weight:'bold', size:'lg', color:'#333333' },
        { type:'text', text:`‡πÑ‡∏î‡πâ ${correctCount}/10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`, size:'md', margin:'md', color:'#555555' },
        ...(correctCount>=8 ? [{ type:'text', text:'üëë ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å!', size:'md', margin:'md', color:'#DAA520' }] : [])
      ]}
    }
  };
  liff.shareTargetPicker([bubble]).catch(console.error);
});

$(document).ready(init);
</script>
</body>
</html>
