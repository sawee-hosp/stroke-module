<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
  body{font-family:"Noto Sans Thai";background:#f5f5f5;padding:16px;margin:0}
  .container{max-width:400px;margin:0 auto;background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
  h1{text-align:center;color:#003366;margin-bottom:20px}

  .step{display:none}
  .active{display:block}

  .question{opacity:0; margin-bottom:16px;
    animation: fadeInUp 0.5s forwards;}
  @keyframes fadeInUp {
    from { opacity:0; transform:translateY(20px); }
    to   { opacity:1; transform:translateY(0); }
  }

  .question p{margin:0 0 8px;font-weight:bold}
  .question label{display:block;cursor:pointer;margin-bottom:6px}

  .btn{display:block;width:100%;padding:12px;background:#007BFF;color:#fff;border:none;border-radius:8px;margin-top:12px;cursor:pointer}
  .btn:hover{background:#0056b3}

  #result{display:none;text-align:center;margin-top:20px}
  #result p{margin:8px 0}
</style>
</head>
<body>
<div class="container">
  <h1>‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å Quiz</h1>

  <!-- Quiz Form -->
  <form id="quizForm" class="active">
    <!-- 10 Questions -->
    <div id="questions"></div>
    <button type="submit" class="btn">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
  </form>

  <!-- Result -->
  <div id="result">
    <h2 id="resultTitle"></h2>
    <p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô <span id="score"></span>/10</p>
    <div id="explanations"></div>
    <button id="share" class="btn">‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
  </div>
</div>

<script>
const liffId    = '2005789397-ROQvjpYk';
const GAS_URL   = 'https://script.google.com/macros/s/AKfycbzDE6SfY8Mabbwn-ojHWmNbqov0XYtpHZqFiOzM9SnISPnPNhOuy7x3wZj1lsV_CtvOFA/exec';

let userId, userName;
const quizData = [
  // 1-3: Stroke & ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢
  {
    q: '1. Stroke ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?',
    opts: ['‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î', '‡∏™‡∏°‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠', '‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô', '‡∏™‡∏°‡∏≠‡∏á‡∏ó‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î'],
    a: 0,
    exp: 'Stroke ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏≠‡∏á‡∏Ç‡∏≤‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡πÉ‡∏ô‡∏™‡∏°‡∏≠‡∏á'
  },
  {
    q: '2. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?',
    opts: ['‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á', '‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô', '‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà', '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß'],
    a: 2,
    exp: '‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ'
  },
  {
    q: '3. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?',
    opts: ['‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á', '‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô', '‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà'],
    a: 0,
    exp: '‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ'
  },
  // 4-6: BEFAST
  {
    q: '4. B ‡πÉ‡∏ô BE-FAST ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å?',
    opts: ['Balance (‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏™‡∏µ‡∏¢)', 'Blink', 'Breathing', 'Blood'],
    a: 0,
    exp: 'B = Balance ‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏™‡∏µ‡∏¢'
  },
  {
    q: '5. E ‡πÉ‡∏ô BE-FAST ‡∏Ñ‡∏∑‡∏≠?',
    opts: ['Eyes (‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î)', 'Exercise', 'Eat', 'Energy'],
    a: 0,
    exp: 'E = Eyes ‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ'
  },
  {
    q: '6. S ‡πÉ‡∏ô BE-FAST ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å?',
    opts: ['Speech (‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î)', 'Smile', 'Shock', 'Sense'],
    a: 0,
    exp: 'S = Speech ‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î'
  },
  // 7-9: ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß
  {
    q: '7. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å?',
    opts: ['‡πÇ‡∏ó‡∏£ 1669', '‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥', '‡∏ô‡∏≠‡∏ô‡∏û‡∏±‡∏Å', '‡πÑ‡∏õ‡∏´‡∏≤‡∏´‡∏°‡∏≠‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ'],
    a: 0,
    exp: '‡∏Ñ‡∏ß‡∏£‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô 1669 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ'
  },
  {
    q: '8. rtPA ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏µ‡πà‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á?',
    opts: ['4.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á', '6 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á', '3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á', '2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á'],
    a: 0,
    exp: 'rtPA ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 4.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£'
  },
  {
    q: '9. ‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?',
    opts: ['‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏≠‡∏á', '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡πà‡∏≤', '‡πÇ‡∏ó‡∏£‡∏ö‡∏≠‡∏Å‡∏õ‡∏≤‡∏Å‡πÄ‡∏õ‡∏•‡πà‡∏≤'],
    a: 0,
    exp: '‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‚Äú‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‚Äù ‡πÉ‡∏ô LINE'
  },
  // 10: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ LINE
  {
    q: '10. ‡πÉ‡∏ô LINE ‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏≠?',
    opts: ['‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô 1669', '‡πÇ‡∏ó‡∏£ 191', '‡∏™‡πà‡∏á‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå', '‡πÇ‡∏ó‡∏£ 1442'],
    a: 0,
    exp: '‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô 1669‚Äù ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å'
  }
];

async function initLiff() {
  await liff.init({ liffId });
  if (!liff.isLoggedIn()) {
    liff.login();
  } else {
    const prof = await liff.getProfile();
    userId   = prof.userId;
    userName = prof.displayName;
  }
}

function renderQuiz() {
  const $q = $('#questions').empty();
  quizData.forEach((item,i) => {
    const $div = $('<div>').addClass('question');
    $div.append(`<p>${item.q}</p>`);
    item.opts.forEach((opt,j) => {
      const id = `q${i}_o${j}`;
      $div.append(`
        <label for="${id}">
          <input type="radio" name="q${i}" id="${id}" value="${j}"> ${opt}
        </label>`);
    });
    $q.append($div);
  });
}

$(document).ready(() => {
  initLiff();
  renderQuiz();

  $('#quizForm').submit(async e => {
    e.preventDefault();
    const answers = [];
    let correctCount = 0;
    const explanations = [];

    quizData.forEach((item,i) => {
      const val = parseInt($(`input[name=q${i}]:checked`).val() || -1);
      if (val === item.a) {
        correctCount++;
      } else {
        explanations.push(`‡∏Ç‡πâ‡∏≠ ${i+1}: ${item.exp}`);
      }
      answers.push(val === item.a ? 1 : 0);
    });

    // ‡∏™‡πà‡∏á‡πÑ‡∏õ GAS
    await $.ajax({
      url: GAS_URL,
      type: 'POST',
      data: JSON.stringify({
        userId,
        segments: [{
          pre: answers,    // ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏Å‡πá‡∏ö answers ‡πÅ‡∏ó‡∏ô‡∏´‡∏•‡∏≤‡∏¢ segment
          post: answers
        }]
      }),
      contentType: 'application/json'
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    $('#quizForm').hide();
    $('#score').text(correctCount);
    $('#explanations').html(explanations.map(e=>`<p>${e}</p>`).join(''));
    const title = correctCount >= 8
      ? `${userName} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å! üéâ`
      : `‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${correctCount} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
    $('#resultTitle').text(title);
    $('#result').show();
  });

  $('#share').click(() => {
    const flex = {
      type: 'flex',
      altText: '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πÇ‡∏ï‡∏£‡∏Å',
      contents: {
        type: 'bubble',
        body: {
          type: 'box',
          layout: 'vertical',
          contents: [
            { type:'text', text: (correctCount>=8 ? `${userName} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å!` : `‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${correctCount} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`), weight:'bold', size:'lg' },
            { type:'text', text: `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${$('#score').text()}/10`, margin:'md' }
          ]
        }
      }
    };
    liff.shareTargetPicker([flex]).catch(console.error);
  });

});
</script>
</body>
</html>
