<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Noto Sans Thai',sans-serif!important;font-size:18px;
         background:#f0f2f5;display:flex;justify-content:center;
         align-items:flex-start;padding:40px 0}
    .container{width:100%;max-width:480px;padding:0 16px}
    button,input,label,a{font-family:'Noto Sans Thai',sans-serif!important}
    .card{background:#fff;border-radius:8px;
          box-shadow:0 2px 6px rgba(0,0,0,0.05);
          padding:20px;margin-bottom:20px;text-align:center;
          min-height:300px;display:flex;flex-direction:column;
          justify-content:center}
    h1{font-size:28px;color:#1a237e;margin-bottom:16px}
    .intro{line-height:1.6;color:#333;margin-bottom:16px;font-size:20px}
    .intro .highlight{font-weight:700;color:#FF5722}
    .button-group{display:flex;gap:12px}
    .btn{flex:1;padding:12px;font-size:18px;font-weight:700;
         color:#fff;border:none;border-radius:6px;cursor:pointer;
         background:linear-gradient(45deg,#1e88e5,#42a5f5);
         transition:background .2s}
    .btn:hover{background:linear-gradient(45deg,#1565c0,#1e7ae1)}
    #quiz-card,#result-card{display:none}
    #progress{position:relative;height:8px;background:#e0e0e0;
             border-radius:4px;margin-bottom:16px}
    #progress-bar{height:100%;width:0;background:#1e88e5;transition:width .3s}
    #qindex{position:absolute;top:20px;left:50%;transform:translateX(-50%);
            font-size:16px;font-weight:700;color:#333}
    .question{font-size:28px;font-weight:700;color:#1a237e;margin:24px 0}
    .choices label{display:block;font-size:22px;margin-bottom:12px;
                   padding:12px;background:#f7f7f7;border-radius:6px;
                   cursor:pointer;transition:background .2s;text-align:left}
    .choices label:hover{background:#ececec}
    .choices input{margin-right:12px;transform:scale(1.2)}
    #submitBtn{display:none;width:100%;padding:12px;margin-top:16px;
               background:#5e35b1;color:#fff;border:none;border-radius:6px;
               font-size:18px;font-weight:700;cursor:pointer;
               transition:background .2s}
    #submitBtn:hover{background:#512da8}
    .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;
           background:rgba(0,0,0,0.4);justify-content:center;
           align-items:center;z-index:1000}
    .modal-content{background:#fff;padding:24px;border-radius:6px;
                   text-align:center;width:90%;max-width:360px}
    .modal-content p{font-size:22px;margin-bottom:16px}
    .modal-content button{padding:10px 24px;font-size:18px;
                          font-weight:700;color:#fff;
                          background:#1e88e5;border:none;
                          border-radius:6px;cursor:pointer;
                          transition:background .2s}
    .modal-content button:hover{background:#1565c0}
    #result-card h2{font-size:22px;margin-bottom:16px}
    #result-card p{font-size:18px;margin-bottom:12px;line-height:1.6}
    #result-card p .line1{font-weight:700;color:#FF9800}
    #result-card p .line2{font-weight:700;color:#4CAF50}
    #result-card p .line3{font-weight:700;color:#E91E63}
    #btnLearn{display:inline-block;padding:8px 16px;font-size:16px;
              color:#1e88e5;background:none;border:1px solid #1e88e5;
              border-radius:4px;text-decoration:none;margin-bottom:16px}
    #shareBtn{display:none;width:100%;padding:12px;margin-top:16px;
              background:linear-gradient(45deg,#fb8c00,#ffb74d);
              color:#fff;border:none;border-radius:6px;
              font-size:18px;font-weight:700;cursor:pointer;transition:background .2s}
    #shareBtn:hover{background:linear-gradient(45deg,#f57c00,#ffa726)}
    /* Ensure .btn uses Noto and looks consistent */
#learn-card .btn {
  font-family: 'Noto Sans Thai', sans-serif !important;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: background .2s;
}
#learn-card .btn:hover {
  opacity: 0.9;
}
.asm-quiz-btn {
  background: #795548;     /* brown */
  color: #fff;
  margin-top: 24px;
  width: 100%;
  padding: 12px;
  font-size: 18px;
  font-weight: 700;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background .2s;
}
.asm-quiz-btn:hover {
  background: #5d4037;
}


  </style>
</head>
<body>
  <div class="container">
    <h1>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h1>

    <!-- Start Card -->
    <div id="start-card" class="card">
      <div id="start-text" class="intro">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Ä¶</div>
      <div class="button-group">
        <button id="btnQuiz" class="btn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
      </div>
    </div>

    <!-- Quiz Card -->
    <div id="quiz-card" class="card">
      <div id="progress">
        <span id="qindex">1/10</span>
        <div id="progress-bar"></div>
      </div>
      <div id="questionText" class="question"></div>
      <div id="choicesContainer" class="choices"></div>
      <button id="submitBtn">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    </div>

    <!-- Result Card -->
    <div id="result-card" class="card">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
      <p id="resultMessage"></p>
      <a id="btnLearn" href="https://lin.ee/mQhHzLv" target="_blank">‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£</a><br/>
      <button id="shareBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>
  </div>
<!-- Learn Stroke Module (hidden until invoked) -->
<div id="learn-card" class="card" style="display:none; flex-direction:column; align-items:center;">
  <h2 id="learn-title" style="margin-bottom:12px; font-size:24px;"></h2>
  <div id="learn-content" style="font-size:18px; line-height:1.6; text-align:left; max-width:100%;"></div>
  <div class="button-group" style="margin-top:20px; width:100%; justify-content:center;">
    <button id="prevLearnBtn" class="btn" style="flex:1; padding:8px 16px; font-size:16px; background:#ccc; color:#333;">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <button id="nextLearnBtn" class="btn" style="flex:1; padding:8px 16px; font-size:16px; background:#1e88e5; color:#fff; margin:0 8px;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    <button id="closeLearnBtn" class="btn" style="flex:1; padding:8px 16px; font-size:16px; background:#f44336; color:#fff;">‡∏õ‡∏¥‡∏î</button>
  </div>
</div>
<button id="btnAsmQuiz" class="asm-quiz-btn">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å</button>



  <!-- Answer Modal -->
  <div id="answerModal" class="modal">
    <div class="modal-content">
      <p id="modalMessage"></p>
      <button id="modalNextBtn">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
    </div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwt4O6aTK_NqGGdYaIF6gRbv5f37dgFeQYZ7ZLxZIRYGBEz54EnJx1hS36XPhET1AOgHg/exec';
    const LIFF_ID = '2005789397-ROQvjpYk';
    let userProfile, questions = [], idx = 0, score = 0, wrongs = [], cachedRank, cachedTotal;

    function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

    function loadHistory(){
      const s=document.createElement('script');
      s.src = `${GAS_URL}?action=getHistory&userId=${encodeURIComponent(userProfile.userId)}&level=general&callback=handleHistory`;
      document.head.appendChild(s);
    }
    window.handleHistory = data => {
      const txt = document.getElementById('start-text');
      if (data?.length) {
        window._last = data[data.length - 1];
        const s2 = document.createElement('script');
        s2.src = `${GAS_URL}?action=getUserName&userId=${encodeURIComponent(userProfile.userId)}&callback=handleUserName`;
        document.head.appendChild(s2);
      } else {
        txt.innerHTML = `<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</span><br/>
                         ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö<br/>
                         ‡πÑ‡∏î‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏±‡∏ö`;
      }
    };
    window.handleUserName = resp => {
      const nm = resp.name || userProfile.displayName;
      const txt = document.getElementById('start-text');
      if (_last.score < _last.full_score) {
        txt.innerHTML = `<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span><br/>
                         ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏ì ${nm} ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${_last.score}/${_last.full_score}<br/>
                         ‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ô!`;
      } else {
        txt.innerHTML = `<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ${nm} ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span><br/>
                         ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏ô‡∏µ‡πà‡∏ô‡∏≤ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏° ${_last.full_score}<br/>
                         ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà<br/>
                         ‡∏Å‡πá‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢`;
      }
    };

    document.getElementById('btnQuiz').onclick = () => {
      const s = document.createElement('script');
      s.src = `${GAS_URL}?action=getQuiz&level=general&callback=handleQuiz`;
      document.head.appendChild(s);
    };
    window.handleQuiz = data => {
      questions = data; idx = 0; score = 0; wrongs = [];
      document.getElementById('start-card').style.display = 'none';
      document.getElementById('quiz-card').style.display  = 'block';
      showQuestion();
    };
    function showQuestion(){
      const q = questions[idx];
      document.getElementById('qindex').textContent = `${idx+1}/${questions.length}`;
      document.getElementById('progress-bar').style.width = `${(idx+1)/questions.length*100}%`;
      document.getElementById('questionText').textContent = q.question;
      const cont = document.getElementById('choicesContainer'); cont.innerHTML = '';
      shuffle(['choice1','choice2','choice3','choice4']).forEach(k=>{
        const lbl = document.createElement('label');
        lbl.textContent = q[k];
        lbl.onclick = () => {
          document.getElementById('submitBtn').style.display = 'block';
          document.querySelectorAll('.choices label').forEach(l=>l.classList.remove('selected'));
          lbl.classList.add('selected');
        };
        cont.appendChild(lbl);
      });
      cont.querySelectorAll('label').forEach(l=>{
        const inp = document.createElement('input');
        inp.type='radio'; inp.name='choice'; inp.value=l.textContent;
        l.prepend(inp);
      });
      const sb = document.getElementById('submitBtn');
      sb.style.display = 'none';
      sb.onclick = () => checkAnswer(questions[idx]);
    }
    function checkAnswer(q){
      const sel = document.querySelector('input[name="choice"]:checked');
      if (!sel) return;
      const chosen = sel.value.trim(), correct = q.correct_choice.trim();
      const modal = document.getElementById('answerModal'), msg = document.getElementById('modalMessage');
      if (chosen === correct) {
        score++;
        msg.textContent = '‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!';
      } else {
        wrongs.push(q.test_id);
        msg.textContent = `üòû ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ ${correct}`;
      }
      modal.style.display = 'flex';
      document.getElementById('modalNextBtn').onclick = () => {
        modal.style.display = 'none';
        idx < questions.length - 1 ? showQuestionAt(idx+1) : finishQuiz();
      };
    }
    function showQuestionAt(i){ idx = i; document.getElementById('submitBtn').style.display = 'none'; showQuestion(); }

    function finishQuiz(){
      document.getElementById('quiz-card').style.display='none';
      document.getElementById('result-card').style.display='block';
      let lines;
      if(score <= 4) {
        lines = [
          `<span class="line1">‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏™‡πÇ‡∏ï‡∏£‡∏Å</span>`,
          `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á`,
          `‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á ‡∏£‡∏π‡πâ‡∏Ñ‡∏£‡∏ö ‡∏à‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`
        ];
      } else if(score <= 8) {
        lines = [
          `<span class="line2">‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à</span>`,
          `‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°`,
          `‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏≠‡∏±‡∏û‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° 10 ‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞`
        ];
      } else {
        lines = [
          `<span class="line3">‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏•‡∏¢ ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å</span>`,
          `‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÑ‡∏õ‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ï‡∏±‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö`,
          `‡∏ß‡πà‡∏≤‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏π‡πâ‡πÄ‡∏ó‡πà‡∏≤ ‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ó‡∏±‡∏ô‡∏£‡∏±‡∏Å‡∏©‡∏≤`
        ];
      }
      document.getElementById('resultMessage').innerHTML =
        `<strong>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${score}/${questions.length} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong><br/>` +
        lines.join('<br/>');

      const p=[
        'action=recordResult',
        `userId=${encodeURIComponent(userProfile.userId)}`,
        'level=general',
        `score=${score}`,
        `full_score=${questions.length}`,
        'posttest=true',
        `wrong=${encodeURIComponent(wrongs.join(','))}`,
        'callback=cacheRank'
      ];
      const s = document.createElement('script');
      s.src = `${GAS_URL}?${p.join('&')}`;
      document.head.appendChild(s);
    }
    window.cacheRank = resp => {
      if(resp.status==='success'){
        cachedRank=resp.rank; cachedTotal=resp.totalPlayers;
        document.getElementById('shareBtn').style.display='block';
      }
    };
let currentLevel = 'general';  // default

// utility to load any level
function loadQuiz(level) {
  currentLevel = level;
  // hide any visible cards
  document.getElementById('start-card').style.display = 'none';
  document.getElementById('learn-card').style.display = 'none';
  document.getElementById('quiz-card').style.display = 'none';
  document.getElementById('result-card').style.display = 'none';
  // fetch quiz
  const cb = 'handleQuiz'; // your existing callback
  const s = document.createElement('script');
  s.src = `${GAS_URL}?action=getQuiz&level=${level}&callback=${cb}`;
  document.head.appendChild(s);
}

// wire up the new ASM button
document.getElementById('btnAsmQuiz').onclick = () => {
  loadQuiz('asm');
};
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° shareBtn ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å recordResult ‡∏û‡∏£‡πâ‡∏≠‡∏° callback=handleShareRecord
document.getElementById('shareBtn').onclick = () => {
  const params = [
    'action=recordResult',
    `userId=${encodeURIComponent(userProfile.userId)}`,
    'level=general',
    `score=${score}`,
    `full_score=${questions.length}`,
    'posttest=true',
    `wrong=${encodeURIComponent(wrongs.join(','))}`,
    'callback=handleShareRecord'
  ];
  const s = document.createElement('script');
  s.src = `${GAS_URL}?${params.join('&')}`;
  document.head.appendChild(s);
};

window.handleShareRecord = resp => {
  if (resp.status !== 'success') return console.error(resp);

  // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô
  const name       = userProfile.displayName || '‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
  const pictureUrl = userProfile.pictureUrl;

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß
  const flex = {
    type:    'flex',
    altText: `${name} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å`,
    contents: {
      type:       'bubble',
      size:       'mega',
      header: {
        type:           'box',
        layout:         'vertical',
        backgroundColor:'#FFF9C4',
        contents: [
          {
            type:   'text',
            text:   `${name} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å`,
            align:  'center',
            weight: 'bold',
            size:   'lg'
          }
        ]
      },
      hero: {
        type:       'image',
        url:        pictureUrl,
        size:       'full',
        aspectMode: 'cover',
        aspectRatio:'1:1',
        gravity:    'center'
      },
      body: {
        type:           'box',
        layout:         'vertical',
        backgroundColor:'#FFF9C4',
        spacing:        'sm',
        contents: [
          { type:'text', text:'üëë', align:'center', size:'4xl' },
          { type:'text', text:`‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å ${score}/${questions.length}`, align:'center', size:'md', weight:'bold' },
          { type:'text', text:`‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${cachedRank} ‡∏à‡∏≤‡∏Å ${cachedTotal}`, align:'center', size:'sm' }
        ]
      },
      footer: {
        type:           'box',
        layout:         'horizontal',
        backgroundColor:'#FFF9C4',
        spacing:        'none',
        paddingAll:     '0px',
        contents: [
          {
            type:'button', style:'primary', color:'#FBC02D',
            action:{ type:'uri', label:'‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö', uri:`https://liff.line.me/${LIFF_ID}` }
          },
          {
            type:'button', style:'secondary', color:'#FFFFFF',
            action:{ type:'uri', label:'‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£', uri:'https://lin.ee/mQhHzLv' }
          }
        ]
      }
    }
  };

  // ‡πÅ‡∏ä‡∏£‡πå flex (‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ API ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)
  if (liff.isInClient() && liff.isApiAvailable('shareTargetPicker')) {
    liff.shareTargetPicker([flex])
      .then(()=>console.log('‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'))
      .catch(err=>console.error('shareTargetPicker error',err));
  } else if (liff.isApiAvailable('sendMessages')) {
    // fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö browser ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
    liff.sendMessages([flex])
      .then(()=>console.log('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (fallback)'))
      .catch(err=>console.error('sendMessages error',err));
  } else {
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ô LINE app');
  }
};


// ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ LIFF init ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Å‡πà‡∏≠‡∏ô
document.addEventListener('DOMContentLoaded', async () => {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) await liff.login();
  userProfile = await liff.getProfile();
      loadHistory();
});
// 1. Define the 4 chapters
const learnSlides = [
  {
    title: '‡πÇ‡∏£‡∏Ñ‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£',
    content: `<p>‡πÇ‡∏£‡∏Ñ‡∏™‡πÇ‡∏ï‡∏£‡∏Å (Stroke) ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏°‡∏û‡∏≤‡∏ï‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ã‡∏µ‡∏Å ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏°‡∏≠‡∏á
              ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏Å ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
              ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡πà‡∏ß‡∏á‡∏ó‡∏µ</p>`
  },
  {
    title: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡πÇ‡∏ï‡∏£‡∏Å',
    content: `<ul style="padding-left:1.2em;list-style-type:disc;">
                <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á</li>
                <li>‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô</li>
                <li>‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á</li>
                <li>‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</li>
                <li>‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ (AF)</li>
                <li>‡πÇ‡∏£‡∏Ñ‡∏≠‡πâ‡∏ß‡∏ô</li>
                <li>‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</li>
              </ul>`
  },
  {
    title: '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ BEFAST',
    content: `<p><strong>B</strong> (Balance): ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏≥‡∏ö‡∏≤‡∏Å<br/>
              <strong>E</strong> (Eyes): ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏ã‡πâ‡∏≠‡∏ô/‡∏û‡∏£‡πà‡∏≤‡∏°‡∏±‡∏ß<br/>
              <strong>F</strong> (Face): ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß<br/>
              <strong>A</strong> (Arm): ‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á<br/>
              <strong>S</strong> (Speech): ‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î<br/>
              <strong>T</strong> (Time): ‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡∏£‡∏µ‡∏ö‡πÑ‡∏õ ‡∏£‡∏û. ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>`
  },
  {
    title: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏™‡∏•‡∏≤‡∏¢‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î',
    content: `<p>‡∏¢‡∏≤‡∏™‡∏•‡∏≤‡∏¢‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î ‡πÄ‡∏ä‡πà‡∏ô tPA ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô
              ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≠‡∏á ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
              4.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>`
  }
];

// 2. State
let learnIdx = 0;

// 3. Grab DOM elements
const learnCard      = document.getElementById('learn-card');
const learnTitle     = document.getElementById('learn-title');
const learnContent   = document.getElementById('learn-content');
const prevBtn        = document.getElementById('prevLearnBtn');
const nextBtn        = document.getElementById('nextLearnBtn');
const closeBtn       = document.getElementById('closeLearnBtn');
const resultCard     = document.getElementById('result-card');

// 4. Render slide
function showLearnSlide(i) {
  const slide = learnSlides[i];
  learnTitle.innerHTML   = slide.title;
  learnContent.innerHTML = slide.content;
  prevBtn.style.display  = i === 0 ? 'none' : 'block';
  nextBtn.textContent    = i === learnSlides.length - 1 ? '‡∏à‡∏ö‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' : '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
}
prevBtn.onclick = () => { learnIdx--; showLearnSlide(learnIdx); };
nextBtn.onclick = () => {
  if (learnIdx < learnSlides.length - 1) {
    learnIdx++; showLearnSlide(learnIdx);
  } else {
    closeBtn.click();
  }
};
closeBtn.onclick = () => {
  learnCard.style.display = 'none';
  resultCard.style.display = 'block';
};

// 5. Hook up the ‚Äú‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‚Äù button
// Replace your existing btnLearn href with this:
document.getElementById('btnLearn').onclick = () => {
  resultCard.style.display = 'none';
  learnIdx = 0;
  showLearnSlide(learnIdx);
  learnCard.style.display = 'flex';
};


  </script>
</body>
</html>
