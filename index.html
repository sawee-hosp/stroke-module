<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet"/>
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
  body,button,label,input{font-family:'Noto Sans Thai',sans-serif!important}
  body{background:#f0f2f5;display:flex;justify-content:center;padding:40px 0}
  .container{width:100%;max-width:480px;padding:0 16px}
  h1{text-align:center;font-size:28px;color:#1a237e;margin-bottom:16px}

  /* History Card */
  #history-card{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);
    padding:20px;text-align:center;margin-bottom:24px;min-height:120px;display:flex;
    align-items:center;justify-content:center;font-size:20px;color:#333}

  /* Grid of 4 cards */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
  .card{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);
    padding:20px;text-align:center;cursor:pointer;min-height:140px;display:flex;
    flex-direction:column;justify-content:center;transition:transform .2s}
  .card:hover{transform:translateY(-4px)}
  .card.active{border:2px solid #1e88e5;background:#e8f0fe}
  .emoji{font-size:36px;margin-bottom:8px}
  .title{font-size:18px;font-weight:700;color:#333}

  /* Quiz Card */
  #quiz-card,#result-card,#learn-card,#asm-guide{display:none}
  #quiz-card{min-height:500px;padding-top:20px}
  #progress{position:relative;height:8px;background:#e0e0e0;border-radius:4px;margin:0 0 16px}
  #progress-bar{height:100%;width:0;background:#1e88e5;transition:width .3s}
  #qindex{position:absolute;top:-4px;left:50%;transform:translateX(-50%);font-size:14px;font-weight:700;color:#333}
  .question{font-size:28px;font-weight:700;color:#1a237e;margin:24px 0}
  .choices label{display:block;font-size:22px;padding:12px;background:#f7f7f7;
    border-radius:6px;margin-bottom:12px;cursor:pointer;transition:background .2s;text-align:left}
  .choices label:hover{background:#ececec}
  .choices input{margin-right:12px;transform:scale(1.2)}
  #submitBtn{display:none;width:100%;padding:12px;margin-top:16px;
    background:#5e35b1;color:#fff;border:none;border-radius:6px;font-size:18px;font-weight:700;
    cursor:pointer;transition:background .2s}
  #submitBtn:hover{background:#512da8}
  .link-note{font-size:14px;color:#666;margin-top:12px;text-align:left}
  .link-note span{color:#1e88e5;cursor:pointer}

  /* Result Card */
  #result-card{min-height:500px;padding-top:20px;text-align:center}
  .result-emoji{font-size:64px;margin-bottom:16px}
  .result-message{font-size:22px;line-height:1.6}
  #shareBtn{display:none;width:100%;padding:12px;margin-top:24px;
    background:linear-gradient(45deg,#fb8c00,#ffb74d);color:#fff;border:none;border-radius:6px;
    font-size:18px;font-weight:700;cursor:pointer;transition:background .2s}
  #shareBtn:hover{background:linear-gradient(45deg,#f57c00,#ffa726)}

  /* Modal (Answer) */
  .modal{position:fixed;top:0;left:0;right:0;bottom:0;
    background:rgba(0,0,0,0.4);display:flex;justify-content:center;
    align-items:center;z-index:1000}
  .modal-content{background:#fff;padding:24px;border-radius:6px;
    max-width:360px;width:90%;text-align:center}
  .modal-emoji{font-size:64px;margin-bottom:16px}     /* ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
  .modal-text{font-size:24px;margin-bottom:24px}      /* ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
  .modal-content button{padding:10px 24px;font-size:18px;font-weight:700;
    color:#fff;background:#1e88e5;border:none;border-radius:6px;cursor:pointer;transition:.2s}
  .modal-content button:hover{background:#1565c0}

  /* Accordion */
  .accordion{margin:16px 0}
  .accordion-item:not(:last-child){border-bottom:1px solid #ddd}
  .accordion-header{padding:12px;font-size:18px;font-weight:700;cursor:pointer;
    background:#e3f2fd;display:flex;justify-content:space-between;align-items:center}
  .accordion-header.active{background:#bbdefb}
  .accordion-header .icon{font-size:20px}
  .accordion-body{padding:12px;font-size:16px;line-height:1.6;display:none}

  .emoji-large{font-size:64px;text-align:center;margin-bottom:16px}
</style>
</head>
<body>
<div class="container">
  <h1>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h1>

  <!-- 1) History Card -->
  <div id="history-card">
    <div id="history-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Ä¶</div>
  </div>

  <!-- 2) 4 Cards Grid -->
  <div class="grid">
    <div id="cardGeneralQuiz" class="card"><div class="emoji">‚ùì</div><div class="title">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div></div>
    <div id="cardGeneralLearn" class="card"><div class="emoji">üìñ</div><div class="title">‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å</div></div>
    <div id="cardAsmQuiz" class="card"><div class="emoji">ü©∫</div><div class="title">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å</div></div>
    <div id="cardAsmGuide" class="card"><div class="emoji">üìã</div><div class="title">‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å</div></div>
  </div>

  <!-- 3) Quiz Card -->
  <div id="quiz-card" class="card">
    <div id="progress"><span id="qindex">1/10</span><div id="progress-bar"></div></div>
    <div id="questionText" class="question"></div>
    <div id="choicesContainer" class="choices"></div>
    <button id="submitBtn">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    <div class="link-note">‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡∏Å‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà¬†<span id="openLearn">üìñ</span></div>
  </div>

  <!-- 4) Result Card -->
  <div id="result-card" class="card">
    <div id="resultEmoji" class="result-emoji"></div>
    <div id="resultMessage" class="result-message"></div>
    <button id="shareBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
  </div>
</div>

<!-- Answer Modal -->
<div id="answerModal" class="modal" style="display:none">
  <div class="modal-content">
    <div id="modalEmoji" class="modal-emoji"></div>
    <div id="modalMessage" class="modal-text"></div>
    <button id="modalNextBtn">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
  </div>
</div>

<!-- General Knowledge Modal -->
<div id="learn-card" class="modal">
  <div class="modal-content" style="max-height:80vh;overflow:auto;text-align:left">
    <h2>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å</h2>
    <div class="accordion">
      <div class="accordion-item">
        <div class="accordion-header">1. ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å ‚Äú‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <p>‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á ‡∏Ñ‡∏∑‡∏≠‡∏†‡∏≤‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏°‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
          ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ï‡∏µ‡∏ö‡∏ï‡∏±‡∏ô (Ischemic) ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏Å/‡∏£‡∏±‡πà‡∏ß (Hemorrhagic) ‡∏™‡πà‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
          ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà‡∏ô‡∏≤‡∏ó‡∏µ ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏±‡∏°‡∏û‡∏§‡∏Å‡∏©‡πå ‡∏≠‡∏±‡∏°‡∏û‡∏≤‡∏ï ‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</p>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">2. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <p><strong>‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:</strong></p>
          <ul style="padding-left:1em">
            <li>‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</li>
            <li>‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢</li>
            <li>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å</li>
          </ul>
          <p><strong>‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ:</strong></p>
          <ul style="padding-left:1em">
            <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á: ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤¬†140/90¬†mmHg</li>
            <li>‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô: ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 70‚Äì130¬†mg/dL</li>
            <li>‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á: ‡∏•‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏±‡∏ô ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏•</li>
            <li>‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà: ‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô</li>
            <li>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‚Äì‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á</li>
            <li>‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥¬†150¬†‡∏ô‡∏≤‡∏ó‡∏µ/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</li>
          </ul>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">3. ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ BEFAST ‡πÅ‡∏•‡∏∞‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <ul style="padding-left:1em">
            <li><strong>B</strong> (Balance): ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏≥‡∏ö‡∏≤‡∏Å</li>
            <li><strong>E</strong> (Eyes): ‡∏ï‡∏≤‡∏°‡∏±‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
            <li><strong>F</strong> (Face): ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß</li>
            <li><strong>A</strong> (Arm): ‡πÅ‡∏Ç‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á</li>
            <li><strong>S</strong> (Speech): ‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î</li>
            <li><strong>T</strong> (Time): ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÇ‡∏ó‡∏£¬†1669¬†‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
          </ul>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">4. ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <p>‡∏´‡∏•‡∏±‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î ‡∏ù‡∏∂‡∏Å‡∏û‡∏π‡∏î ‡∏ù‡∏∂‡∏Å‡∏Å‡∏•‡∏∑‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
          ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô ‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏û‡∏ó‡∏¢‡πå</p>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">5. ‡∏¢‡∏≤‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <p>rT‚ÄêPA ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô¬†4.5¬†‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î
          ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏™‡∏°‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô</p>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">6. ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <ol style="padding-left:1em">
            <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ ‚Äú‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù (LIFF)</li>
            <li>‡∏™‡πÅ‡∏Å‡∏ô QR¬†‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° LIFF</li>
            <li>‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ú‡πà‡∏≤‡∏ô LINE</li>
            <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù</li>
            <li>‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
            <li>‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô Flex message ‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</li>
          </ol>
        </div>
      </div>
    </div>
    <button id="closeLearn" class="btn" style="background:#f44336">‡∏õ‡∏¥‡∏î</button>
  </div>
</div>

<!-- ASM Guide Modal -->
<div id="asm-guide" class="modal">
  <div class="modal-content" style="max-height:80vh;overflow:auto;text-align:left">
    <h2>‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å</h2>
    <div class="accordion">
      <div class="accordion-item">
        <div class="accordion-header">1. ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <p>‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ï‡∏µ‡∏ö‡∏ï‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏Å ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
          ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏£‡πá‡∏ß‡∏†‡∏≤‡∏¢‡πÉ‡∏ô¬†4.5¬†‡∏ä‡∏°. ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏û‡∏¥‡∏Å‡∏≤‡∏£</p>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">2. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <ul style="padding-left:1em">
            <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°¬†<140/90¬†mmHg</li>
            <li>‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• 70‚Äì130¬†mg/dL</li>
            <li>‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏±‡∏ô</li>
            <li>‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà ‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
            <li>‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á ‡∏ß‡∏±‡∏î‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå</li>
          </ul>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">3. ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ BEFAST<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <ul style="padding-left:1em">
            <li>B: ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏≥‡∏ö‡∏≤‡∏Å</li>
            <li>E: ‡∏ï‡∏≤‡∏°‡∏±‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
            <li>F: ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß</li>
            <li>A: ‡πÅ‡∏Ç‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á</li>
            <li>S: ‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î</li>
            <li>T: ‡πÇ‡∏ó‡∏£¬†1669¬†‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
          </ul>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">4. ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <ul style="padding-left:1em">
            <li>‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</li>
            <li>‡∏ß‡∏±‡∏î‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß ‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏∞‡∏î‡∏∑‡∏≠ ‡∏Ç‡∏ì‡∏∞‡∏ú‡πà‡∏≠‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à</li>
            <li>‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î</li>
          </ul>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">5. ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏ß‡∏¢ ‚Äú‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏µ‚Äù ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <p>‡πÅ‡∏ö‡πà‡∏á‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á 10 ‡∏õ‡∏µ¬†: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß¬†<10%, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á¬†10‚Äì<20%, ‡∏™‡πâ‡∏°¬†20‚Äì<30%, ‡πÅ‡∏î‡∏á¬†‚â•30%</p>
        </div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">6. ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏≠‡∏™‡∏°.<span class="icon">Ôºã</span></div>
        <div class="accordion-body">
          <ol style="padding-left:1em">
            <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ LIFF¬†‚Äú‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù</li>
            <li>‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô LINE</li>
            <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù</li>
            <li>‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö 20¬†‡∏Ç‡πâ‡∏≠</li>
            <li>‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•</li>
            <li>‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î ‚Äú‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‚Äù</li>
          </ol>
        </div>
      </div>
    </div>
    <button id="closeAsm" class="btn" style="background:#f44336">‡∏õ‡∏¥‡∏î</button>
  </div>
</div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const GAS_URL='https://script.google.com/macros/s/AKfycbwt4O6aTK_NqGGdYaIF6gRbv5f37dgFeQYZ7ZLxZIRYGBEz54EnJx1hS36XPhET1AOgHg/exec',LIFF_ID='2005789397-ROQvjpYk';
let userProfile, questions = [], idx = 0, score = 0, wrongs = [];
let cachedRank, cachedTotal;
let histGen, histAsm, _name;

// SHUFFLE
const shuffle=a=>{for(let i=a.length-1;i>0;i--){let j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]];}return a;};
// 1) ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô logic ‡πÄ‡∏î‡∏¥‡∏°
async function init() {
  await liff.init({liffId:LIFF_ID});
  if(!liff.isLoggedIn()) await liff.login();
  userProfile = await liff.getProfile();
  loadHistory();
}
const instructionText = `*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏ì‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•*

*1. ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πÇ‡∏ï‡∏£‡∏Å*
‚Ä¢ ‡πÇ‡∏ó‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (1669)
‚Ä¢ ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤ ‚Äú‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù, ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢, ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å, ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
‚Ä¢ ‡∏´‡∏≤‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤ "‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á Line ‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÅ‡∏•‡πâ‡∏ß"

*2. ‡∏Ç‡∏ì‡∏∞‡∏£‡∏≠‡∏£‡∏ñ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•*
‚Ä¢ ‡πÉ‡∏´‡πâ‡∏ô‡∏≠‡∏ô‡∏£‡∏≤‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏ô‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏™‡∏π‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (15-30¬∞)
‚Ä¢ ‡∏Ñ‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏™‡∏∞‡∏î‡∏ß‡∏Å
‚Ä¢ **‡∏´‡πâ‡∏≤‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î**
‚Ä¢ ‡πÄ‡∏ù‡πâ‡∏≤‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÉ‡∏à

*3. ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•*
‚Ä¢ ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏£‡∏ñ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
‚Ä¢ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ä‡∏∑‡πà‡∏≠, ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß, ‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ç‡∏≤‡∏ï‡∏¥
‚Ä¢ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô

*4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•*
‚Ä¢ ‡∏£‡∏µ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå/‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ß‡πà‡∏≤ ‚Äú‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å‚Äù ‡πÅ‡∏•‡∏∞‡∏ö‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å`;

function doGet(e) {
  const lock = LockService.getScriptLock();
  lock.waitLock(30000);
  try {
    const action = e.parameter.action;
    const callback = e.parameter.callback;

    if (action === 'getUserData' && e.parameter.userId) {
      const userRecord = checkUserRegistration(e.parameter.userId);
      return ContentService.createTextOutput(`${callback}(${JSON.stringify(userRecord)})`).setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
    if (action === 'getVolunteerData' && e.parameter.areaKey) {
      const volunteerRecord = getVolunteerContacts(e.parameter.areaKey);
      return ContentService.createTextOutput(`${callback}(${JSON.stringify(volunteerRecord)})`).setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
    if (action === 'saveData' && e.parameter.data) {
      const data = JSON.parse(decodeURIComponent(e.parameter.data));
      saveDailyCheckData(data);

      if (data.isEmergency) {
        try {
          const props = PropertiesService.getScriptProperties();
          const CHANNEL_ACCESS_TOKEN = props.getProperty('CHANNEL_ACCESS_TOKEN');

          const emergencyFlex = sendEmergencyFlex(data, true); 
          const plainTextSummary = { type: 'text', text: createPlainTextSummary(data) };
          const instructionTextMessage = { type: 'text', text: instructionText };

          const messages = [emergencyFlex, plainTextSummary, instructionTextMessage];
          
          // Your original code sends messages to the user (data.userID)
          // If you want to send to a group, replace data.userID with your Group ID
          pushMessage(data.userID, messages, CHANNEL_ACCESS_TOKEN);

        } catch (lineError) {
          console.error("CRITICAL: Failed to send LINE notification. Error: " + lineError.toString());
        }
      } else {
        sendNonUrgentFlex(data);
      }
      return ContentService.createTextOutput(`${callback}(${JSON.stringify({ status: 'success' })})`).setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
    return HtmlService.createHtmlOutputFromFile('index').setTitle("‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πÇ‡∏ï‡∏£‡∏Å").setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
  } catch (err) {
    console.error(err);
    if (e.parameter.callback) {
      return ContentService.createTextOutput(`${e.parameter.callback}(${JSON.stringify({ status: 'error', message: err.message })})`).setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
  } finally {
    lock.releaseLock();
  }
}

function getSpreadsheet() {
  const props = PropertiesService.getScriptProperties();
  const SPREADSHEET_ID = props.getProperty('SHEET_ID');
  if (!SPREADSHEET_ID) throw new Error("SHEET_ID is not set in Script Properties.");
  return SpreadsheetApp.openById(SPREADSHEET_ID);
}

function saveDailyCheckData(data) {
    const ss = getSpreadsheet();
    const sheet = ss.getSheetByName("daily_check");
    if (!sheet) throw new Error("Sheet 'daily_check' not found.");

    const HEADERS = [
        "timestamp", "eventId", "userID", "userName", "BEFAST", "symptom", "frequency", "time", 
        "location", "distance", "duration", "tel_sawee", "tel_1669",
        "tel_asm1", "tel_asm2", "tel_header", "tel_pcu", 
        "arrivalDeadline", "rtpaDeadline", "ambulanceEstimate", "selfTravelEstimate", "notificationSent"
    ];

    if (sheet.getLastRow() < 1) {
        sheet.appendRow(HEADERS);
    }

    const eventId = data.eventId;
    if (!eventId) {
        const newRowData = HEADERS.map(header => mapDataToHeader(header, data, true));
        sheet.appendRow(newRowData);
        return;
    }

    const eventIdCol = HEADERS.indexOf("eventId") + 1;
    const dataRange = sheet.getDataRange();
    const values = dataRange.getValues();
    let rowToUpdate = -1;

    for (let i = values.length - 1; i > 0; i--) {
        if (values[i][eventIdCol - 1] === eventId) {
            rowToUpdate = i + 1;
            break;
        }
    }

    if (rowToUpdate > -1) {
        const existingRow = values[rowToUpdate - 1];
        const updatedRowData = HEADERS.map((header, index) => {
            const newValue = mapDataToHeader(header, data, false);
            if (header.startsWith("tel_") && existingRow[index]) {
                return existingRow[index];
            }
            if (header === "timestamp" && existingRow[index]) {
                return existingRow[index];
            }
            return newValue || existingRow[index];
        });
        sheet.getRange(rowToUpdate, 1, 1, HEADERS.length).setValues([updatedRowData]);
    } else {
        const newRowData = HEADERS.map(header => mapDataToHeader(header, data, true));
        sheet.appendRow(newRowData);
    }
}

function mapDataToHeader(header, data, isNewRow) {
    if (header === "timestamp" && isNewRow) return new Date();
    switch(header) {
        case "eventId": return data.eventId || "";
        case "BEFAST": return data.symptomCategory || "";
        case "symptom": return data.symptomDetail || "";
        case "time": return data.onsetTime || "";
        default:
            return data[header] || "";
    }
}

function checkUserRegistration(userId) {
  const response = { status: 'not_found', data: null };
  if (!userId) return response;
  try {
    const ss = getSpreadsheet();
    const sheet = ss.getSheetByName("database");
    if (!sheet) return response;
    const data = sheet.getDataRange().getValues();
    const headerRow = data[0].map(h => h.toString().trim());
    const colMap = {};
    headerRow.forEach((h, i) => { colMap[h] = i; });
    const userIdCol = colMap['userId'];
    if (userIdCol === undefined) return { status: 'error', message: 'Column "userId" not found.' };
    const timestampCol = colMap['timestamp'];

    for (let i = data.length - 1; i > 0; i--) {
      if (data[i][userIdCol] && data[i][userIdCol].toString().trim() === userId.toString().trim()) {
        response.status = 'found';
        response.data = {
          name: data[i][colMap['name']] || '',
          thai_cv_risk_score: data[i][colMap['thai_cv_risk_score']] || 'N/A',
          risk_group: data[i][colMap['risk_group']] || 'N/A',
          district: data[i][colMap['district']] || '',
          village: data[i][colMap['village']] || '',
          timestamp: (timestampCol !== undefined && data[i][timestampCol]) ? data[i][timestampCol] : ''
        };
        return response;
      }
    }
    return response;
  } catch (e) {
    console.error('ERROR in checkUserRegistration: ' + e.toString());
    response.status = 'error'; response.data = e.toString();
    return response;
  }
}

function getVolunteerContacts(areaKey) {
  const response = { status: 'not_found', data: null };
  if (!areaKey) return response;
  try {
    const ss = getSpreadsheet();
    const sheet = ss.getSheetByName("volunteer_list");
    if (!sheet) return response;
    const data = sheet.getDataRange().getValues();
    const headerRow = data[0].map(h => h.toString().trim());
    const colMap = {};
    headerRow.forEach((h, i) => { colMap[h] = i; });
    const areaCol = colMap['area'];
    if (areaCol === undefined) return { status: 'error', message: 'Column "area" not found.' };
    for (let i = 1; i < data.length; i++) {
      if (data[i][areaCol] && data[i][areaCol].toString().trim() === areaKey.toString().trim()) {
        response.status = 'found';
        response.data = {
          volunteer1_tel: data[i][colMap['volunteer1_tel']] || '',
          volunteer2_tel: data[i][colMap['volunteer2_tel']] || '',
          headman_tel: data[i][colMap['headman_tel']] || '',
          pcu_tel: data[i][colMap['pcu_tel']] || '',
          pcu_name: data[i][colMap['pcu_name']] || ''
        };
        return response;
      }
    }
    return response;
  } catch (e) {
    console.error("Error in getVolunteerContacts: " + e.toString());
    response.status = 'error'; response.data = e.toString();
    return response;
  }
}

function sendNonUrgentFlex(data) {
  const props = PropertiesService.getScriptProperties();
  const CHANNEL_ACCESS_TOKEN = props.getProperty('CHANNEL_ACCESS_TOKEN');
  const DAILY_CHECK_LIFF_ID = "2005789397-WRm1lYd9";
  const HEALTH_INFO_LIFF_ID = "2005789397-RLAGXrBJ";
  if (!CHANNEL_ACCESS_TOKEN || !data.userID) return;
  let bodyText = data.randomGreeting ? data.randomGreeting : data.symptomDetail || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥';
  let headerColor = data.randomGreeting ? "#007BFF" : "#28A745";
  const flexMessage = {
    type: "flex", altText: "‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô",
    contents: {
      type: "bubble",
      header: {
        type: "box", layout: "vertical", backgroundColor: headerColor, contents: [
          { type: "text", text: "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô", color: "#ffffff", weight: "bold", size: "lg" },
          { type: "text", text: `‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ${data.userName}`, color: "#ffffffcc", size: "sm" }
        ]
      },
      body: {
        type: "box", layout: "vertical", spacing: "md", contents: [
          { type: "text", text: "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:", weight: "bold" },
          { type: "text", text: bodyText, wrap: true, size: "md" },
          { type: "text", text: `‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: ${new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' })}`, size: "xs", color: "#aaaaaa", margin: "lg" }
        ]
      },
      footer: {
        type: "box", layout: "vertical", spacing: "sm", contents: [
          { type: "button", style: "primary", color: headerColor, height: "sm", action: { type: "uri", label: "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ã‡πâ‡∏≥‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", uri: `https://liff.line.me/${DAILY_CHECK_LIFF_ID}` } },
          { "type": "button", "style": "secondary", "height": "sm", "action": { "type": "uri", "label": "‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "uri": `https://liff.line.me/${HEALTH_INFO_LIFF_ID}` } },
          { "type": "text", "text": "‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ ‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å", "size": "xxs", "color": "#cccccc", "align": "center", "margin": "md" }
        ]
      }
    }
  };
  if (data.frequency === '‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πà‡∏≤‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô') {
    flexMessage.contents.footer.contents.splice(1, 0, { "type": "button", "style": "secondary", "height": "sm", "action": { "type": "uri", "label": "‡πÇ‡∏ó‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ 1669", "uri": "tel:1669" } });
  }
  pushMessage(data.userID, [flexMessage], CHANNEL_ACCESS_TOKEN);
}

function sendEmergencyFlex(data, returnObject = false) {
  const props = PropertiesService.getScriptProperties();
  const CHANNEL_ACCESS_TOKEN = props.getProperty('CHANNEL_ACCESS_TOKEN');
  const HEALTH_INFO_LIFF_ID = "2005789397-RLAGXrBJ";
  const hospitalCoords = "10.2300226,99.1087481";
  const gmapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${hospitalCoords}`;
  const flexMessage = {
    "type": "flex", "altText": "‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á",
    "contents": {
      "type": "bubble", "size": "mega",
      "header": {
        "type": "box", "layout": "vertical", "backgroundColor": "#D32F2F", "paddingAll": "20px", "contents": [
          { "type": "text", "text": "‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (‡∏™‡πÇ‡∏ï‡∏£‡∏Å)", "color": "#ffffff", "weight": "bold", "size": "xl" },
          { "type": "text", "text": `‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ${data.registeredName || data.userName}`, "color": "#ffffffcc", "size": "md", "margin": "sm" }
        ]
      },
      "body": {
        "type": "box", "layout": "vertical", "spacing": "lg", "paddingAll": "20px", "backgroundColor": "#FFF0F0", "contents": [
          createFlexSection("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏£", [createKeyValueRow("‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:", data.symptomDetail), createKeyValueRow("‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠:", data.onsetTime)]),
          { "type": "separator" },
          createFlexSection("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤", [
            createKeyValueRow("‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∂‡∏á ‡∏£‡∏û. ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (3.5‡∏ä‡∏°.)", data.arrivalDeadline),
            createKeyValueRow("‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (4.5‡∏ä‡∏°.)", data.rtpaDeadline)
          ]),
          { "type": "separator" },
          createFlexSection("‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á", [
            createKeyValueRow("‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:", data.distance || "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î"),
            createKeyValueRow("‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡πÄ‡∏≠‡∏á:", data.selfTravelEstimate || "-"),
            createKeyValueRow("‡∏£‡∏ñ ‡∏£‡∏û. ‡πÑ‡∏õ‡∏£‡∏±‡∏ö:", data.ambulanceEstimate || "-")
          ])
        ]
      },
      "footer": {
        "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "10px", "contents": [
          { "type": "button", "style": "primary", "color": "#34A853", "height": "sm", "action": { "type": "uri", "label": "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ ‡∏£‡∏û.‡∏™‡∏ß‡∏µ", "uri": gmapsUrl } },
          { "type": "button", "style": "primary", "color": "#D32F2F", "height": "sm", "action": { "type": "uri", "label": "‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô 1669", "uri": "tel:1669" } },
          { "type": "button", "style": "secondary", "height": "sm", "action": { "type": "uri", "label": "‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "uri": `https://liff.line.me/${HEALTH_INFO_LIFF_ID}` } },
          { "type": "text", "text": "‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ ‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å", "wrap": true, "size": "xxs", "align": "center", "color": "#888888", "margin": "md" }
        ]
      }
    }
  };
  if (returnObject) {
    return flexMessage;
  }
  pushMessage(data.userID, [flexMessage], CHANNEL_ACCESS_TOKEN);
}

function createPlainTextSummary(data) {
  return `‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å:
üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${data.registeredName || data.userName}
üè† ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ‡∏ï.${data.district || 'N/A'} ‡∏°.${data.village || 'N/A'}
üö® ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£: ${data.symptomDetail} (${data.symptomCategory})
‚è±Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${data.onsetTime}
üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${data.location || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏'}
‚òéÔ∏è ‡∏Å‡∏î‡πÇ‡∏ó‡∏£‡∏´‡∏≤: ${data.contactedVia || 'N/A'}`;
}

function createFlexSection(title, contentRows) {
  return {
    "type": "box", "layout": "vertical", "contents": [
      { "type": "text", "text": title, "weight": "bold", "size": "lg", "margin": "md", "color": "#555555" },
      { "type": "box", "layout": "vertical", "margin": "lg", "spacing": "sm", "contents": contentRows }
    ]
  };
}

function createKeyValueRow(key, value) {
  const isUrgent = value && value.includes && value.includes("‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô");
  return {
    type: "box", layout: "baseline", spacing: "sm", contents: [
      { type: "text", text: key, color: "#aaaaaa", size: "sm", flex: 3, "wrap": true },
      { type: "text", text: value || 'N/A', color: isUrgent ? "#D32F2F" : "#666666", size: "sm", flex: 5, wrap: true, weight: isUrgent ? "bold" : "regular" }
    ]
  };
}

function pushMessage(userId, messages, token) {
  UrlFetchApp.fetch('https://api.line.me/v2/bot/message/push', {
    method: 'post', contentType: 'application/json',
    headers: { 'Authorization': 'Bearer ' + token },
    payload: JSON.stringify({ to: userId, messages: messages }),
    muteHttpExceptions: true
  });
}

// SHARE FLEX
window.handleShareRecord = resp => {
  if (resp.status !== 'success') return console.error(resp);
  const name = window._name || userProfile.displayName || '‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
  const pic  = userProfile.pictureUrl;

  const flex = {
    type: 'flex',
    altText: `${name} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å`,
    contents: {
      type: 'bubble',
      size: 'kilo',
      header: {
        type: 'box',
        layout: 'vertical',
        backgroundColor: '#FFF9C4',
        paddingAll: '12px',
        contents: [
          {
            type: 'text',
            text: `${name} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å`,
            align: 'center',
            weight: 'bold',
            size: 'lg'
          },
          {
            type: 'text',
            text: '‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ó‡∏±‡∏ô ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏±‡∏°‡∏û‡∏≤‡∏ï',
            align: 'center',
            color: '#FF9800',
            size: 'sm'
          }
        ]
      },
      body: {
        type: 'box',
        layout: 'vertical',
        backgroundColor: '#FFF9C4',
        spacing: 'sm',
        paddingAll: '0px',
        contents: [
          {
            type: 'text',
            text: 'üëë',
            align: 'center',
            size: '4xl',
            margin: 'md'
          },
          {
            type: 'image',
            url: pic,
            size: 'full',
            aspectMode: 'cover',
            aspectRatio: '1:1',
            gravity: 'center',
            cornerRadius: '999px',
            margin: 'md'
          },
          {
            type: 'text',
            text: `‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å ${score}/${questions.length}`,
            align: 'center',
            weight: 'bold',
            size: 'md',
            margin: 'md'
          },
          {
            type: 'text',
            text: `‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${cachedRank} ‡∏à‡∏≤‡∏Å ${cachedTotal}`,
            align: 'center',
            color: '#666666',
            size: 'sm',
            margin: 'xs'
          },
          {
            type: 'text',
            text: '‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏î‡∏µ‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏¢',
            align: 'center',
            color: '#D32F2F',
            size: 'sm',
            margin: 'md'
          }
        ]
      },
      footer: {
        type: 'box',
        layout: 'horizontal',
        backgroundColor: '#FFF9C4',
        spacing: 'none',
        paddingAll: '0px',
        contents: [
          {
            type: 'button',
            style: 'primary',
            color: '#FBC02D',
            action: {
              type: 'uri',
              label: '‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö',
              uri: `https://liff.line.me/${LIFF_ID}`
            }
          },
          {
            type: 'button',
            style: 'secondary',
            color: '#FFFFFF',
            action: {
              type: 'uri',
              label: '‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å',
              uri: 'https://lin.ee/mQhHzLv'
            }
          }
        ]
      }
    }
  };

  // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏ä‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢ shareTargetPicker (‡πÉ‡∏ô LINE client)
  if (liff.isInClient() && liff.isApiAvailable('shareTargetPicker')) {
    liff.shareTargetPicker([flex])
      .then(() => console.log('‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'))
      .catch(err => console.error('shareTargetPicker error', err));
  }
  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà LINE client ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ API ‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ fallback ‡πÑ‡∏õ sendMessages
  else if (liff.isApiAvailable('sendMessages')) {
    liff.sendMessages([flex])
      .then(() => console.log('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (fallback)'))
      .catch(err => console.error('sendMessages error', err));
  } else {
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ô LINE app');
  }
};


// Accordion logic
document.querySelectorAll('.accordion-header').forEach(h=>{
  h.onclick=_=>{
    let open=h.classList.toggle('active');
    h.nextElementSibling.style.display=open?'block':'none';
    h.querySelector('.icon').textContent=open?'‚àí':'Ôºã';
  };
});

// ASM GUIDE CLOSE
document.getElementById('closeLearn').onclick=_=>document.getElementById('learn-card').style.display='none';
document.getElementById('closeAsm').onclick=_=>document.getElementById('asm-guide').style.display='none';

// LIFF init
document.addEventListener('DOMContentLoaded',async()=>{
  await liff.init({liffId:LIFF_ID});
  if(!liff.isLoggedIn()) await liff.login();
  userProfile = await liff.getProfile();
  loadHistory();
});
</script>

</body>
</html>
