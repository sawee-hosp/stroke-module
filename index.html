<!DOCTYPE html>
<html lang="th"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</title><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet"/><style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans Thai',sans-serif!important;font-size:18px;background:#f0f2f5;display:flex;justify-content:center;padding:40px 0}
.container{width:100%;max-width:480px;padding:0 16px}
button,label,a{font-family:'Noto Sans Thai',sans-serif!important}
.grid-cards{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.tile{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);padding:16px;text-align:center;cursor:pointer;min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:background .2s}
.tile:hover{background:#ececec}
.tile .emoji{font-size:36px;margin-bottom:8px}
.tile .label{font-size:14px;color:#333}
.card{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);padding:20px;margin-bottom:20px;text-align:center;min-height:300px;display:flex;flex-direction:column;justify-content:center}
h1{font-size:28px;color:#1a237e;margin-bottom:16px}
.intro{font-size:20px;line-height:1.6;color:#333;margin-bottom:16px}
.intro .highlight{font-weight:700;color:#FF5722}
.button-group{display:flex;gap:12px;margin-top:16px}
.btn{flex:1;padding:12px;font-size:18px;font-weight:700;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:background .2s}
.btn-primary{background:linear-gradient(45deg,#1e88e5,#42a5f5)}
.btn-primary:hover{background:linear-gradient(45deg,#1565c0,#1e7ae1)}
.btn-secondary{background:#795548}
.btn-secondary:hover{background:#5d4037}
.btn-link{display:inline-block;padding:8px 16px;font-size:16px;color:#1e88e5;background:none;border:1px solid #1e88e5;border-radius:4px;text-decoration:none;margin-top:16px}
#quiz-card,#result-card,#learn-card,#asm-guide{display:none}
#progress{position:relative;height:8px;background:#e0e0e0;border-radius:4px;margin-bottom:16px}
#progress-bar{height:100%;width:0;background:#1e88e5;transition:width .3s}
#qindex{position:absolute;top:-24px;left:50%;transform:translateX(-50%);font-size:16px;font-weight:700;color:#333}
.question{font-size:28px;font-weight:700;color:#1a237e;margin:24px 0}
.choices label{display:block;font-size:22px;margin-bottom:12px;padding:12px;background:#f7f7f7;border-radius:6px;cursor:pointer;transition:background .2s;text-align:left}
.choices label:hover{background:#ececec}
.choices input{margin-right:12px;transform:scale(1.2)}
.choices + .hint{font-size:14px;color:#666;text-align:left;margin-top:8px}
#submitBtn{display:none;width:100%;padding:12px;margin-top:16px;background:#5e35b1;color:#fff;border:none;border-radius:6px;font-size:18px;font-weight:700;cursor:pointer;transition:background .2s}
#submitBtn:hover{background:#512da8}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);justify-content:center;align-items:center;z-index:1000}
.modal-content{background:#fff;padding:24px;border-radius:6px;text-align:center;width:90%;max-width:400px;overflow-y:auto;max-height:80vh}
.modal-content h2{font-size:22px;margin-bottom:12px}
.modal-content ul{padding-left:1.2em;list-style:disc;font-size:18px;line-height:1.6;text-align:left;margin-bottom:16px}
.modal-content p{font-size:18px;line-height:1.6;margin-bottom:16px;text-align:left}
.modal-content button{padding:10px 24px;font-size:18px;font-weight:700;color:#fff;background:#1e88e5;border:none;border-radius:6px;cursor:pointer;transition:background .2s}
.modal-content button:hover{background:#1565c0}
#result-card h2{font-size:22px;margin-bottom:16px}
#resultMessage{font-size:18px;line-height:1.6;margin-bottom:16px}
#btnLearn{display:inline-block;padding:8px 16px;font-size:16px;color:#1e88e5;background:none;border:1px solid #1e88e5;border-radius:4px;text-decoration:none;margin-top:16px}
#shareBtn{display:none;width:100%;padding:12px;margin-top:16px;background:linear-gradient(45deg,#fb8c00,#ffb74d);color:#fff;border:none;border-radius:6px;font-size:18px;font-weight:700;cursor:pointer;transition:background .2s}
#shareBtn:hover{background:linear-gradient(45deg,#f57c00,#ffa726)}
#asm-guide .modal-content{max-width:400px;text-align:left}
#asm-guide h2{font-size:22px;margin-bottom:12px}
#asm-guide ul{padding-left:1.2em;list-style:disc;font-size:18px;line-height:1.6;margin-bottom:16px}
</style></head><body>
  <div class="container">
    <h1>‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h1>
    <!-- Top tiles -->
    <div class="grid-cards">
      <div class="tile" id="tile-general"><div class="emoji">üß†</div><div class="label">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div></div>
      <div class="tile" id="tile-read"><div class="emoji">üìñ</div><div class="label">‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å</div></div>
      <div class="tile" id="tile-asm"><div class="emoji">ü©∫</div><div class="label">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏≠‡∏™‡∏°.</div></div>
      <div class="tile" id="tile-guide"><div class="emoji">üìã</div><div class="label">‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á ‡∏≠‡∏™‡∏°.</div></div>
    </div>

    <!-- Start Card -->
    <div id="start-card" class="card">
      <div id="start-text" class="intro">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Ä¶</div>
      <div class="button-group">
        <button id="btnQuiz" class="btn btn-primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
      </div>
    </div>

    <!-- Quiz Card -->
    <div id="quiz-card" class="card">
      <div id="progress"><span id="qindex">1/10</span><div id="progress-bar"></div></div>
      <div id="questionText" class="question"></div>
      <div id="choicesContainer" class="choices"></div>
      <div class="hint">‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‡∏Å‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</div>
      <button id="submitBtn">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    </div>

    <!-- Result Card -->
    <div id="result-card" class="card">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
      <div id="resultMessage"></div>
      <div class="button-group">
        <button id="btnLearn" class="btn btn-link">‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡πÇ‡∏ï‡∏£‡∏Å</button>
      </div>
      <button id="shareBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>
  </div>

  <!-- Read‚ÄëStroke Modal -->
  <div id="learn-card" class="modal">
    <div class="modal-content">
      <h2>‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å</h2>
      <ul id="learn-menu">
        <li data-i="0">1. ‡πÇ‡∏£‡∏Ñ‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</li>
        <li data-i="1">2. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô</li>
        <li data-i="2">3. ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ BEFAST</li>
        <li data-i="3">4. ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å</li>
        <li data-i="4">5. ‡∏¢‡∏≤‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î (rT-PA)</li>
        <li data-i="5">6. ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° ‡∏•‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡πÇ‡∏ï‡∏£‡∏Å</li>
      </ul>
      <div id="learn-content"></div>
      <div class="button-group">
        <button id="closeLearnBtn" class="btn btn-secondary">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>

  <div id="asm-guide" class="modal">
    <div class="modal-content">
      <h2>‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å</h2>
      <ul id="asm-menu">
        <li data-i="0">1. ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á</li>
        <li data-i="1">2. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô</li>
        <li data-i="2">3. ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ BEFAST</li>
        <li data-i="3">4. ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</li>
        <li data-i="4">5. ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏ß‡∏¢ ‚Äú‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏µ‚Äù ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</li>
      </ul>
      <div id="asm-content" style="margin-top:16px;"></div>
      <div class="button-group">
        <button id="closeAsmBtn" class="btn btn-primary">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>

  <!-- Answer Modal -->
  <div id="answerModal" class="modal">
    <div class="modal-content">
      <p id="modalMessage"></p>
      <button id="modalNextBtn">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
    </div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const GAS_URL='https://script.google.com/macros/s/AKfycbwt4O6aTK_NqGGdYaIF6gRbv5f37dgFeQYZ7ZLxZIRYGBEz54EnJx1hS36XPhET1AOgHg/exec';
    const LIFF_ID='2005789397-ROQvjpYk';
    let userProfile,questions=[],idx=0,score=0,wrongs=[],cachedRank,cachedTotal,currentLevel='general';
    const learnSlides=[
      {title:'‡πÇ‡∏£‡∏Ñ‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£',content:`<p>‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏Ñ‡∏∑‡∏≠ ‡∏†‡∏≤‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‚Ä¶</p>`},
      {title:'‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô',content:`<p><strong>‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:</strong><br/>‡∏≠‡∏≤‡∏¢‡∏∏, ‡πÄ‡∏û‡∏®, ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ø‡∏•‡∏Ø<br/><strong>‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ:</strong><br/>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á, ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‚Ä¶</p>`},
      {title:'‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ BEFAST',content:`<ul><li>Balance...</li><li>Eyes...</li>‚Ä¶</ul>`},
      {title:'‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡πÇ‡∏ï‡∏£‡∏Å',content:`<ul><li>‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</li><li>‡πÇ‡∏ó‡∏£ 1669</li>‚Ä¶</ul>`},
      {title:'‡∏¢‡∏≤‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î (rT-PA)',content:`<p>‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 4.5 ‡∏ä‡∏°.‚Ä¶</p>`},
      {title:'‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° ‡∏•‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡πÇ‡∏ï‡∏£‡∏Å',content:`<ul><li>‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£...</li><li>‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢...</li>‚Ä¶</ul>`}
    ];
    function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
    async function loadHistory(){
      const cb='handleHistory',s=document.createElement('script');
      s.src=`${GAS_URL}?action=getHistory&userId=${encodeURIComponent(userProfile.userId)}&level=${currentLevel}&callback=${cb}`;
      document.head.appendChild(s);
    }
    window.handleHistory=data=>{
      const t=document.getElementById('start-text');
      if(data?.length){window._last=data.pop();
        const s2=document.createElement('script');
        s2.src=`${GAS_URL}?action=getUserName&userId=${encodeURIComponent(userProfile.userId)}&callback=handleUserName`;
        document.head.appendChild(s2);
      } else t.innerHTML=`<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</span><br/>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;
    };
    window.handleUserName=resp=>{
      const nm=resp.name||userProfile.displayName;
      const t=document.getElementById('start-text'),{score:ls,full_score:lf}=window._last;
      t.innerHTML=ls<lf
        ?`<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span><br/>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏ì ${nm} ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${ls}/${lf}`
        :`<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ${nm} ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span><br/>‡∏ó‡∏≥‡πÄ‡∏ï‡πá‡∏° ${lf}!`;
    };
    document.getElementById('tile-general').onclick=()=>loadQuiz('general');
    document.getElementById('tile-asm').onclick=()=>loadQuiz('asm');
    document.getElementById('tile-read').onclick=()=>{
      document.getElementById('learn-card').style.display='flex';
      renderLearn(0);
    };
    document.getElementById('tile-guide').onclick=()=>document.getElementById('asm-guide').style.display='flex';
    function loadQuiz(level){
      currentLevel=level;
      ['start-card','quiz-card','result-card'].forEach(id=>document.getElementById(id).style.display='none');
      const cb='handleQuiz',s=document.createElement('script');
      s.src=`${GAS_URL}?action=getQuiz&level=${level}&callback=${cb}`;
      document.head.appendChild(s);
    }
    window.handleQuiz=data=>{
      questions=data;idx=0;score=0;wrongs=[];
      document.getElementById('start-card').style.display='none';
      document.getElementById('quiz-card').style.display='block';
      showQuestion();
    };
    function showQuestion(){
      const q=questions[idx];
      document.getElementById('qindex').textContent=`${idx+1}/${questions.length}`;
      document.getElementById('progress-bar').style.width=`${(idx+1)/questions.length*100}%`;
      document.getElementById('questionText').textContent=q.question;
      const cont=document.getElementById('choicesContainer');cont.innerHTML='';
      shuffle(['choice1','choice2','choice3','choice4']).forEach(k=>{
        const lbl=document.createElement('label');
        lbl.textContent=q[k];
        lbl.onclick=()=>{
          document.getElementById('submitBtn').style.display='block';
          document.querySelectorAll('.choices label').forEach(l=>l.classList.remove('selected'));
          lbl.classList.add('selected');
        };
        cont.appendChild(lbl);
      });
      cont.querySelectorAll('label').forEach(l=>{
        const inp=document.createElement('input');
        inp.type='radio';inp.name='choice';inp.value=l.textContent;
        l.prepend(inp);
      });
      const sb=document.getElementById('submitBtn');
      sb.style.display='none';sb.onclick=()=>checkAnswer(questions[idx]);
    }
    function checkAnswer(q){
      const sel=document.querySelector('input[name="choice"]:checked');if(!sel)return;
      const chosen=sel.value.trim(),correct=q.correct_choice.trim();
      const modal=document.getElementById('answerModal'),msg=document.getElementById('modalMessage');
      msg.innerHTML=chosen===correct
        ?`<div style="font-size:48px">‚úÖ</div><div style="color:green">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ ${correct}</div>`
        :`<div style="font-size:48px">üòû</div><div style="color:green">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ ${correct}</div>`;
      if(chosen!==correct)wrongs.push(q.test_id);
      modal.style.display='flex';
      document.getElementById('modalNextBtn').onclick=()=>{
        modal.style.display='none';
        idx<questions.length-1?showQuestionAt(idx+1):finishQuiz();
      };
    }
    function showQuestionAt(i){idx=i;document.getElementById('submitBtn').style.display='none';showQuestion();}
    function finishQuiz(){
      document.getElementById('quiz-card').style.display='none';
      document.getElementById('result-card').style.display='block';
      let html='';
      if(currentLevel==='general'){
        if(score<=4)html='<span class="highlight">‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏™‡πÇ‡∏ï‡∏£‡∏Å</span><br/>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á';
        else if(score<=8)html='<span class="highlight">‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à</span><br/>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°';
        else html='<span class="highlight">‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏•‡∏¢ ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å</span><br/>‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ï‡∏±‡∏ß';
        html=`<strong>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${score}/${questions.length} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong><br/>${html}`;
        document.getElementById('shareBtn').style.display='block';
      } else {
        html=score<18?'<span class="highlight">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</span><br/>‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà'
                 :'<span class="highlight">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ‡∏≠‡∏™‡∏°.‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£</span>';
        document.getElementById('shareBtn').style.display='none';
      }
      document.getElementById('resultMessage').innerHTML=html;
      const p=['action=recordResult',`userId=${encodeURIComponent(userProfile.userId)}`,
        `level=${currentLevel}`,`score=${score}`,`full_score=${questions.length}`,
        'posttest=true',`wrong=${encodeURIComponent(wrongs.join(','))}`,'callback=cacheRank'],s=document.createElement('script');
      s.src=`${GAS_URL}?${p.join('&')}`;document.head.appendChild(s);
    }
    window.cacheRank=resp=>{if(resp.status==='success'){cachedRank=resp.rank;cachedTotal=resp.totalPlayers;}};
    document.getElementById('shareBtn').onclick=()=>{
      if(currentLevel!=='general')return;const params=['action=recordResult',`userId=${encodeURIComponent(userProfile.userId)}`,
        `level=${currentLevel}`,`score=${score}`,`full_score=${questions.length}`,'posttest=true',
        `wrong=${encodeURIComponent(wrongs.join(','))}`,'callback=handleShareRecord'],scr=document.createElement('script');
      scr.src=`${GAS_URL}?${params.join('&')}`;document.head.appendChild(scr);
    };
   window.handleShareRecord = resp => {
    if (resp.status!=='success') return console.error(resp);
    const name = userProfile.displayName || '‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
          pic  = userProfile.pictureUrl;
    const flex = {
      type:'flex',altText:`${name} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å`,
      contents:{
        type:'bubble',size:'kilo',
        header:{type:'box',layout:'vertical',
          backgroundColor:'#FFF9C4',
          contents:[
            {type:'text',text:`${name} ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å`,align:'center',weight:'bold',size:'lg'},
            {type:'text',text:'‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ó‡∏±‡∏ô ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏±‡∏°‡∏û‡∏≤‡∏ï',align:'center',color:'#FF9800',size:'sm'}
          ]
        },
        body:{type:'box',layout:'vertical',backgroundColor:'#FFF9C4',spacing:'none',paddingAll:'0px',
          contents:[
            {type:'text',text:'üëë',align:'center',size:'4xl',margin:'md'},
            {type:'image',url:pic,aspectMode:'cover',aspectRatio:'1:1',size:'full',gravity:'center',
              cornerRadius:'999px',borderWidth:'4px',borderColor:'#FFFFFF'},
            {type:'text',text:`‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å¬†${score}/${questions.length}`,align:'center',size:'md',weight:'bold',margin:'md'},
            {type:'text',text:`‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà¬†${cachedRank}¬†‡∏à‡∏≤‡∏Å¬†${cachedTotal}`,align:'center',size:'sm',margin:'xs'},
            {type:'text',text:'‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏î‡∏µ‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏¢',align:'center',color:'#D32F2F',size:'sm',margin:'md'}
          ]
        },
        footer:{type:'box',layout:'horizontal',backgroundColor:'#FFF9C4',spacing:'none',paddingAll:'0px',
          contents:[
            {type:'button',style:'primary',color:'#FBC02D',
              action:{type:'uri',label:'‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö',uri:`https://liff.line.me/${LIFF_ID}`}},
            {type:'button',style:'secondary',color:'#FFFFFF',
              action:{type:'uri',label:'‡∏™‡∏ß‡∏µ‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å',uri:'https://lin.ee/mQhHzLv'}}
          ]
        }
      }
    };
    if(liff.isInClient()&&liff.isApiAvailable('shareTargetPicker')){
      liff.shareTargetPicker([flex]).catch(e=>console.error(e));
    }else if(liff.isApiAvailable('sendMessages')){
      liff.sendMessages([flex]).catch(e=>console.error(e));
    }else alert('‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏ô LINE app');
  };

  const asmSlides = [
    {
      title: '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á',
      content: `<p>‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á (Stroke) ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‚Ä¶</p>`
    },
    {
      title: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô',
      content: `<ul style="padding-left:1.2em;list-style:disc;">
                  <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á</li>
                  <li>‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô</li>
                  <li>‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á</li>
                  <li>‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</li>
                  <li>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‚Äì‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á</li>
                  <li>‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</li>
                </ul>`
    },
    {
      title: '‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ BEFAST',
      content: `<ul style="padding-left:1.2em;list-style:disc;">
                  <li><strong>B</strong> Balance: ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏≥‡∏ö‡∏≤‡∏Å</li>
                  <li><strong>E</strong> Eyes: ‡∏ï‡∏≤‡∏°‡∏±‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                  <li><strong>F</strong> Face: ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß</li>
                  <li><strong>A</strong> Arm: ‡πÅ‡∏Ç‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á</li>
                  <li><strong>S</strong> Speech: ‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î</li>
                  <li><strong>T</strong> Time: ‡∏£‡∏µ‡∏ö‡πÑ‡∏õ ‡∏£‡∏û. ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                </ul>`
    },
    {
      title: '‡∏ß‡∏¥‡∏ò‡∏µ‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á',
      content: `<ul style="padding-left:1.2em;list-style:disc;">
                  <li>‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï (‡∏û‡∏±‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏ß‡∏±‡∏î 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</li>
                  <li>‡∏ß‡∏±‡∏î‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß (‡∏™‡∏∞‡∏î‡∏∑‡∏≠ ‡∏Ç‡∏ì‡∏∞‡∏ú‡πà‡∏≠‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à)</li>
                  <li>‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™</li>
                </ul>`
    },
    {
      title: '‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏ß‡∏¢ ‚Äú‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏µ‚Äù ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•',
      content: `<table style="width:100%;text-align:left;border-collapse:collapse;">
                  <tr><th style="border:1px solid #ccc;padding:4px">‡∏™‡∏µ</th>
                      <th style="border:1px solid #ccc;padding:4px">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (%)</th>
                      <th style="border:1px solid #ccc;padding:4px">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</th></tr>
                  <tr><td style="border:1px solid #ccc;padding:4px;background:#C8E6C9">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</td>
                      <td style="border:1px solid #ccc;padding:4px"><¬†10</td>
                      <td style="border:1px solid #ccc;padding:4px">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á</td></tr>
                  <tr><td style="border:1px solid #ccc;padding:4px;background:#FFF9C4">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</td>
                      <td style="border:1px solid #ccc;padding:4px">10‚Äì<¬†20</td>
                      <td style="border:1px solid #ccc;padding:4px">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏∏‡∏Å¬†6¬†‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td></tr>
                  <tr><td style="border:1px solid #ccc;padding:4px;background:#FFE0B2">‡∏™‡πâ‡∏°</td>
                      <td style="border:1px solid #ccc;padding:4px">20‚Äì<¬†30</td>
                      <td style="border:1px solid #ccc;padding:4px">‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏∏‡∏Å¬†3¬†‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td></tr>
                  <tr><td style="border:1px solid #ccc;padding:4px;background:#FFCDD2">‡πÅ‡∏î‡∏á</td>
                      <td style="border:1px solid #ccc;padding:4px">‚â•¬†30</td>
                      <td style="border:1px solid #ccc;padding:4px">‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠ ‡∏£‡∏û. ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</td></tr>
                </table>`
    }
  ];

  // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ASM modal menu
  let asmIdx = 0;
  const asmMenuItems = document.querySelectorAll('#asm-menu li'),
        asmContentDiv = document.getElementById('asm-content');
  function renderAsm(i) {
    asmMenuItems.forEach(li => li.classList.toggle('active', li.dataset.i == i));
    asmContentDiv.innerHTML = asmSlides[i].content;
  }
  asmMenuItems.forEach(li=>li.onclick = ()=>renderAsm(li.dataset.i));
  document.getElementById('closeAsmBtn').onclick = ()=> document.getElementById('asm-guide').style.display='none';

    // --- Learn‚ÄëStroke Module ---
    const menuItems=document.querySelectorAll('#learn-menu li'),contentDiv=document.getElementById('learn-content'),closeLearn=document.getElementById('closeLearnBtn');
    function renderLearn(i){
      menuItems.forEach(li=>li.classList.toggle('active',li.dataset.i==i));
      contentDiv.innerHTML=learnSlides[i].content;
    }
    menuItems.forEach(li=>li.onclick=()=>renderLearn(li.dataset.i));
    closeLearn.onclick=()=>document.getElementById('learn-card').style.display='none';

    // --- ASM Guidance Modal ---
    document.getElementById('closeAsmBtn').onclick=()=>document.getElementById('asm-guide').style.display='none';

    // --- Init ---
    document.addEventListener('DOMContentLoaded',async()=>{
      await liff.init({liffId:LIFF_ID});
      if(!liff.isLoggedIn())await liff.login();
        userProfile=await liff.getProfile();
        loadHistory();
    });
  </script>
</body></html>
